<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thebookquotes.TBQ.mapper.MemberMapper">

    <insert id="insertMember" parameterType="com.thebookquotes.TBQ.dto.Member">
        INSERT INTO member
        VALUES(#{memberUuid},#{memberId},#{memberPw},#{memberGrant},NOW(),#{memberInuse},NOW(),NOW(),#{memberEmail})
    </insert>

    <select id="idCheck" resultType="int">
        SELECT  count(member_id)
        FROM 	member
        WHERE	member_id=#{memberId}
    </select>

    <select id="selectById" resultType="com.thebookquotes.TBQ.dto.Member">
        SELECT *
        FROM 	member
        WHERE	member_id=#{memberId}
    </select>

    <select id="selectByUuid" resultType="com.thebookquotes.TBQ.dto.Member">
        SELECT *
        FROM 	member
        WHERE	member_uuid=#{memberUuid}
    </select>

    <select id="selectMemberList" resultType="com.thebookquotes.TBQ.dto.Member">
        SELECT *
        FROM 	member
        WHERE	member_inuse=1
            limit #{pageStart},#{pageSize}
    </select>

    <update id="lastLoginUpdate" parameterType="com.thebookquotes.TBQ.dto.Member">
        UPDATE member
        SET member_last_login=NOW(), member_edit_date=NOW()
        WHERE member_uuid=#{memberUuid}
    </update>

    <update id="updateMember" parameterType="com.thebookquotes.TBQ.dto.Member">
        UPDATE member
        SET member_id=#{memberId}, member_pw=#{memberPw}, member_email=#{memberEmail},member_edit_date=NOW()
        WHERE member_uuid=#{memberUuid}
    </update>

    <update id="deleteMember" parameterType="com.thebookquotes.TBQ.dto.Member">
        UPDATE member
        SET member_edit_date=NOW(),  member_inuse=#{memberInuse}
        WHERE member_uuid=#{memberUuid}
    </update>

    <select id="selectCount" resultType="int">
        SELECT count(*) FROM member
        WHERE member_inuse=1
    </select>

    <select id="selectByEmail" resultType="com.thebookquotes.TBQ.dto.Member">
        SELECT *
        FROM 	member
        WHERE	member_email=#{memberEmail} and member_inuse=1
    </select>

    <update id="findPw" parameterType="com.thebookquotes.TBQ.dto.Member"><!-- 아이디로 임시비밀번호 변경 -->
        UPDATE member
        SET member_pw=#{memberPw}, member_edit_date=NOW()
        WHERE member_id=#{memberId}
    </update>

    <select id="emailDuplication" resultType="int"><!-- 이메일 중복 체크 -->
        SELECT  count(member_email)
        FROM 	member
        WHERE	member_email=#{memberEmail} and member_inuse=1
    </select>
</mapper>