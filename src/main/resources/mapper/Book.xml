<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.thebookquotes.TBQ.mapper.BookMapper">

    <insert id="insertBook" parameterType="com.thebookquotes.TBQ.dto.BookQuotes">
        /* BookQuotes.insertBook */
        INSERT INTO bookquotes
        SET
        <trim prefixOverrides = ",">
            <if test="bookUuid                 != null">, book_uuid     =   #{bookUuid}         </if>
            <if test="title                != null">, title         =       #{title}             </if>
            <if test="writer                != null">, writer         =     #{writer}            </if>
            <if test="contents             != null">, contents     =       #{contents}           </if>
            <if test="memberUuid         != null">, member_uuid=       #{memberUuid}            </if>
            <if test="inuse          != null">, inuse          =          #{inuse}               </if>
            <if test="readNum              != null">, read_num      =       #{readNum}          </if>
            <if test="img             != null">, img     =                 #{img}                </if>
            <if test="lang             != null">, lang     =                 #{lang}                </if>
            , REGI_DATE           = NOW()               /* 등록일 */
            , EDIT_DATE           = NOW()               /* 수정일 */
        </trim>
    </insert>

    <select id="bookList" resultType="com.thebookquotes.TBQ.dto.BookQuotes">
        /* BookQuotes.bookList */
        SELECT *
        FROM bookquotes
        WHERE INUSE=1
        ORDER BY REGI_DATE desc
        limit #{pageStart},#{pageSize}
    </select>

    <select id="selectBookByUuid" resultType="com.thebookquotes.TBQ.dto.BookQuotes" parameterType="String">
        /* BookQuotes.selectBookByUuid */
        SELECT *
        FROM bookquotes
        WHERE BOOK_UUID=#{bookUuid}
        AND INUSE = 1
    </select>

    <select id="selectCount" resultType="int">
        /* BookQuotes.selectCount */
        SELECT count(*)
        FROM bookquotes
        WHERE INUSE = 1
    </select>

    <update id="updateBook" parameterType="com.thebookquotes.TBQ.dto.BookQuotes">
        /* BookQuotes.updateBook */
        UPDATE bookquotes
        SET
        <trim prefixOverrides = ",">
            <if test="bookUuid                 != null">, book_uuid     =   #{bookUuid}         </if>
            <if test="title                != null">, title         =       #{title}             </if>
            <if test="writer                != null">, writer         =     #{writer}            </if>
            <if test="contents             != null">, contents     =       #{contents}           </if>
            <if test="memberUuid         != null">, member_uuid=       #{memberUuid}            </if>
            <if test="inuse          != null">, inuse          =          #{inuse}               </if>
            <if test="readNum              != null">, read_num      =       #{readNum}          </if>
            <if test="img             != null">, img     =                 #{img}                </if>
            , EDIT_DATE           = NOW()               /* 수정일 */
        </trim>
        WHERE BOOK_UUID=#{bookUuid}
    </update>

    <update id="deleteBook" parameterType="String">
        /* BookQuotes.deleteBook */
        UPDATE bookquotes
        SET EDIT_DATE=NOW(), inuse=0
        WHERE BOOK_UUID=#{bookUuid}
    </update>

    <insert id="insertCmt" parameterType="com.thebookquotes.TBQ.dto.BookQuotes$Comment">
        /* BookQuotes.insertCmt */
        INSERT INTO cmt
        SET
        <trim prefixOverrides = ",">
            <if test="bookUuid                 != null">, book_uuid     =   #{bookUuid}         </if>
            <if test="memberUuid                 != null">, member_uuid     =   #{memberUuid}         </if>
            <if test="contents             != null">, contents     =       #{contents}           </if>
            <if test="inuse          != null">, cmt_inuse          =          #{inuse}               </if>
            , CMT_REGI_DATE           = NOW()               /* 등록일 */
        </trim>

        <selectKey keyProperty="cmtNum" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <select id="cmtList" resultType="com.thebookquotes.TBQ.dto.BookQuotes$Comment">
        /* BookQuotes.cmtList */
        SELECT cmt_num , m.member_uuid , book_uuid ,cmt_regi_date , cmt_inuse ,contents , m.member_id as memberId
        FROM cmt
        LEFT JOIN member m ON m.member_uuid = cmt.member_uuid
        WHERE CMT_INUSE = 1
        AND BOOK_UUID=#{bookUuid}
        ORDER BY CMT_REGI_DATE desc
    </select>

    <select id="selectByCmt" resultType="com.thebookquotes.TBQ.dto.BookQuotes$Comment" parameterType="int">
        /* BookQuotes.selectByCmt */
        SELECT cmt_num ,member_uuid , book_uuid ,cmt_regi_date , cmt_inuse ,contents
        FROM cmt
        WHERE CMT_NUM=#{cmtNum}
          AND CMT_INUSE = 1
    </select>
</mapper>